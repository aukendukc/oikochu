"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{6504:function(e,t,r){r.d(t,{Z:function(){return u}});var a=r(7437),s=r(2265),l=r(7138),n=r(6463),o=r(666),d=r(7807),i=r(2472),c=r(5574),x=r(4258),h=r(9896);function u(){let{user:e,loading:t,signOut:r}=(0,o.a)(),{theme:u}=(0,d.F)(),g=(0,n.useRouter)(),[m,b]=(0,s.useState)(!1),y=async()=>{await r(),g.push("/")};return(0,a.jsxs)("nav",{className:"bg-blue-500 dark:bg-gray-800 text-white shadow-md",children:[(0,a.jsx)("div",{className:"max-w-6xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,a.jsx)(l.default,{href:"/",className:"font-bold text-xl",children:"ホームレス支援"})})}),!t&&e&&(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-1",children:[(0,a.jsxs)(l.default,{href:"/",className:"py-2 px-3 hover:bg-blue-600 dark:hover:bg-gray-700 rounded flex items-center",children:[(0,a.jsx)(i.Z,{size:18,className:"mr-1"}),"マップ"]}),(0,a.jsxs)(l.default,{href:"/people",className:"py-2 px-3 hover:bg-blue-600 dark:hover:bg-gray-700 rounded flex items-center",children:[(0,a.jsx)(c.Z,{size:18,className:"mr-1"}),"リスト"]}),(0,a.jsxs)(l.default,{href:"/settings",className:"py-2 px-3 hover:bg-blue-600 dark:hover:bg-gray-700 rounded flex items-center",children:[(0,a.jsx)(x.Z,{size:18,className:"mr-1"}),"設定"]}),(0,a.jsxs)("button",{onClick:y,className:"py-2 px-3 hover:bg-blue-600 dark:hover:bg-gray-700 rounded flex items-center",children:[(0,a.jsx)(h.Z,{size:18,className:"mr-1"}),"ログアウト"]})]}),!t&&e&&(0,a.jsx)("div",{className:"md:hidden flex items-center",children:(0,a.jsx)("button",{onClick:()=>b(!m),className:"inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-blue-600 dark:hover:bg-gray-700 focus:outline-none",children:(0,a.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m?(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]})}),m&&!t&&e&&(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsxs)("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-blue-500 dark:bg-gray-800",children:[(0,a.jsxs)(l.default,{href:"/",className:"block px-3 py-2 rounded text-white hover:bg-blue-600 dark:hover:bg-gray-700 flex items-center",onClick:()=>b(!1),children:[(0,a.jsx)(i.Z,{size:18,className:"mr-2"}),"マップ"]}),(0,a.jsxs)(l.default,{href:"/people",className:"block px-3 py-2 rounded text-white hover:bg-blue-600 dark:hover:bg-gray-700 flex items-center",onClick:()=>b(!1),children:[(0,a.jsx)(c.Z,{size:18,className:"mr-2"}),"リスト"]}),(0,a.jsxs)(l.default,{href:"/settings",className:"block px-3 py-2 rounded text-white hover:bg-blue-600 dark:hover:bg-gray-700 flex items-center",onClick:()=>b(!1),children:[(0,a.jsx)(x.Z,{size:18,className:"mr-2"}),"設定"]}),(0,a.jsxs)("button",{onClick:()=>{b(!1),y()},className:"block w-full text-left px-3 py-2 rounded text-white hover:bg-blue-600 dark:hover:bg-gray-700 flex items-center",children:[(0,a.jsx)(h.Z,{size:18,className:"mr-2"}),"ログアウト"]})]})})]})}},6848:function(e,t,r){r.d(t,{Z:function(){return j}});var a=r(7437),s=r(2265),l=r(6463),n=r(9842),o=r(2574),d=r(419),i=r(624),c=r(6791),x=r(2955);function h(e){let{personId:t}=e,[r,l]=(0,s.useState)(!1),[i,c]=(0,s.useState)(""),[h,u]=(0,s.useState)(""),[g,m]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),[k,j]=(0,s.useState)(!0),v=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=!!window.SpeechRecognition||!!window.webkitSpeechRecognition;return j(e),e||console.warn("Web Speech API is not supported in this browser"),()=>{v.current&&v.current.stop()}},[]);let w=async e=>{try{let t=e.split(/[。.!?！？]/g).filter(e=>e.trim().length>0);if(0===t.length){u("会話の内容から要点を抽出できませんでした。手動で入力してください。");return}let r=t.slice(0,Math.min(4,t.length)).map((e,t)=>"".concat(t+1,". ").concat(e.trim())).join("\n");u(r)}catch(e){console.error("Error generating summary:",e),u("要約の生成に失敗しました。手動で要約を入力してください。")}finally{m(!1)}},N=async()=>{if(!i||!h){alert("記録と要約を生成してください");return}y(!0);try{await (0,n.ET)((0,n.hJ)(o.db,"conversations"),{personId:t,transcript:i,summary:h,date:(0,d.WU)(new Date,"yyyy/MM/dd"),timestamp:new Date().toISOString()}),await (0,n.r7)((0,n.JU)(o.db,"homelessPeople",t),{lastSeen:(0,d.WU)(new Date,"yyyy/MM/dd HH:mm")}),alert("会話が保存されました"),c(""),u("")}catch(e){console.error("Error saving conversation:",e),alert("会話の保存中にエラーが発生しました")}finally{y(!1)}};return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"会話を記録"}),!k&&(0,a.jsx)("div",{className:"bg-yellow-100 dark:bg-yellow-900 border-l-4 border-yellow-500 text-yellow-700 dark:text-yellow-300 p-4 mb-4",children:(0,a.jsx)("p",{children:"お使いのブラウザは音声認識をサポートしていません。Chrome、Edge、またはSafariの最新版をご使用ください。"})}),(0,a.jsx)("div",{className:"mb-6",children:r?(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-1 mb-4",children:[(0,a.jsx)(x.E.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5},className:"w-3 h-3 bg-red-500 rounded-full"}),(0,a.jsx)(x.E.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5,delay:.2},className:"w-3 h-3 bg-red-500 rounded-full"}),(0,a.jsx)(x.E.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5,delay:.4},className:"w-3 h-3 bg-red-500 rounded-full"})]}),(0,a.jsx)("button",{onClick:()=>{l(!1),m(!0),v.current&&v.current.stop(),i?w(i):m(!1)},className:"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white font-bold py-2 px-4 rounded",children:"録音を停止"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-300 text-sm",children:"音声を認識しています..."})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("button",{onClick:()=>{if(!k){alert("お使いのブラウザはWeb Speech APIをサポートしていません。Chrome、Edge、Safariなどの最新のブラウザをご使用ください。");return}c(""),u(""),l(!0);try{let e=window.SpeechRecognition||window.webkitSpeechRecognition;v.current=new e;let t=v.current;t.continuous=!0,t.interimResults=!0,t.lang="ja-JP",t.onresult=e=>{let t="";for(let r=0;r<e.results.length;r++)e.results[r].isFinal&&(t+=e.results[r][0].transcript);""!==t&&c(e=>e+t)},t.onerror=e=>{console.error("Speech recognition error",e),l(!1),alert("音声認識エラー: ".concat(e.error||"不明なエラー"))},t.onend=()=>{if(r)try{t.start()}catch(e){console.error("再起動エラー:",e),l(!1)}},t.start()}catch(e){console.error("Error starting speech recognition:",e),alert("音声認識の開始に失敗しました。ブラウザがWeb Speech APIをサポートしていない可能性があります。"),l(!1)}},className:"bg-blue-500 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-800 text-white font-bold py-2 px-4 rounded",disabled:g||b,children:g?"処理中...":"録音を開始"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-300 text-sm",children:"ボタンをクリックして会話の録音を開始してください"})]})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"会話の記録:"}),(0,a.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:6,placeholder:"録音した会話の文字起こしがここに表示されます。直接編集することもできます。",disabled:r||g||b})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"会話の要約:"}),(0,a.jsx)("textarea",{value:h,onChange:e=>u(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:4,placeholder:"会話の要点を自動的に抽出します。必要に応じて編集してください。",disabled:r||g||b})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:N,className:"bg-green-500 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-800 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",disabled:r||g||b||!i||!h,children:b?"保存中...":"会話を保存"})})]})}var u=r(4697);function g(e){let{conversation:t,onClose:r,onSuccess:l}=e,[d,i]=(0,s.useState)(t.transcript),[c,x]=(0,s.useState)(t.summary),[h,g]=(0,s.useState)(!1),[m,b]=(0,s.useState)(null),y=async e=>{if(e.preventDefault(),g(!0),b(null),!d.trim()||!c.trim()){b("文字起こしと要約は必須項目です"),g(!1);return}try{let e=(0,n.JU)(o.db,"conversations",t.id);await (0,n.r7)(e,{transcript:d,summary:c}),l()}catch(e){console.error("会話の更新に失敗しました:",e),b("会話の更新中にエラーが発生しました。後でもう一度お試しください。")}finally{g(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b dark:border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"会話の編集"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:(0,a.jsx)(u.Z,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:y,className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"日付"}),(0,a.jsx)("input",{type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:t.date,disabled:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"transcript",children:"文字起こし"}),(0,a.jsx)("textarea",{id:"transcript",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:d,onChange:e=>i(e.target.value),rows:6,required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"summary",children:"要約"}),(0,a.jsx)("textarea",{id:"summary",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:c,onChange:e=>x(e.target.value),rows:4,required:!0})]}),m&&(0,a.jsx)("div",{className:"mb-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded",children:m}),(0,a.jsxs)("div",{className:"flex justify-end",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-2 px-4 rounded mr-2 focus:outline-none focus:shadow-outline",disabled:h,children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 dark:bg-blue-600 hover:bg-blue-700 dark:hover:bg-blue-800 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",disabled:h,children:h?"保存中...":"保存"})]})]})]})})}var m=r(4174),b=r(9321),y=r(6649),p=r(399),f=r(7592),k=r(6648);function j(e){var t;let{personId:r,isPopup:x=!1}=e,[u,j]=(0,s.useState)(null),[v,w]=(0,s.useState)([]),[N,S]=(0,s.useState)(!0),[C,E]=(0,s.useState)(null),[P,I]=(0,s.useState)("details"),[R,U]=(0,s.useState)(null),[Z,D]=(0,s.useState)(!1),[L,M]=(0,s.useState)(!1),[z,F]=(0,s.useState)(null),J=(0,l.useRouter)();(0,s.useEffect)(()=>{let e=async()=>{try{if(console.log("PersonDetails: データ取得開始",r),!r){console.error("PersonDetails: personIdが無効です"),E("無効なIDが指定されました"),S(!1);return}let e=(0,n.JU)(o.db,"homelessPeople",r);console.log("PersonDetails: personRefの作成",e);try{let t=await (0,n.QT)(e);if(console.log("PersonDetails: personDocの取得完了",t.exists()),!t.exists()){console.error("PersonDetails: 該当する人物データが存在しません",r),E("指定された人物のデータが見つかりません"),S(!1);return}let a=t.data();console.log("PersonDetails: 人物データ取得成功",a);let s={id:r,...a,locations:a.locations||(a.location?[{latitude:a.location.latitude,longitude:a.location.longitude,description:"元の位置",timestamp:new Date().toISOString()}]:[])};j(s)}catch(e){console.error("人物データ取得エラー:",e),E("人物データの取得中にエラーが発生しました: ".concat(e instanceof Error?e.message:"不明なエラー")),S(!1);return}try{console.log("PersonDetails: 会話データの取得開始");let e=(0,n.IO)((0,n.hJ)(o.db,"conversations"),(0,n.ar)("personId","==",r),(0,n.Xo)("timestamp","desc")),t=(0,n.cf)(e,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),console.log("PersonDetails: 会話データ取得",t.length),w(t),S(!1)},e=>{console.error("会話データスナップショットエラー:",e),E("会話データの取得中にエラーが発生しました: ".concat(e.message)),w([]),S(!1)});return()=>t()}catch(e){console.error("会話データの取得に失敗しました",e),E("会話データの取得中にエラーが発生しました: ".concat(e instanceof Error?e.message:"不明なエラー")),w([]),S(!1)}}catch(e){console.error("Error fetching person data:",e),E("データの取得中にエラーが発生しました: ".concat(e instanceof Error?e.message:"不明なエラー")),S(!1)}};console.log("PersonDetails: コンポーネントマウント",{personId:r,isPopup:x}),S(!0),e()},[r]),(0,s.useEffect)(()=>{u&&U({...u})},[u]);let T=async()=>{if(R&&r){D(!0),M(!1);try{let e=(0,n.JU)(o.db,"homelessPeople",r),{id:t,location:a,...s}=R;await (0,n.r7)(e,s),M(!0),j(R),setTimeout(()=>{M(!1)},3e3)}catch(e){console.error("Error updating person:",e),E("データの更新中にエラーが発生しました")}finally{D(!1)}}},W=e=>{try{return(0,d.WU)((0,i.D)(e),"yyyy年MM月dd日",{locale:c.ja})}catch(t){return e}},G=(e,t)=>{if(x){window.dispatchEvent(new CustomEvent("show-location",{detail:{latitude:e,longitude:t}}));let r=document.querySelector("[data-close-popup]");r&&r.click()}else J.push("/?lat=".concat(e,"&lng=").concat(t))},O=async()=>{if(window.confirm("".concat(null==u?void 0:u.nickname,"の情報を削除しますか？"))){D(!0);try{await (0,n.oe)((0,n.JU)(o.db,"homelessPeople",r)),J.refresh()}catch(e){console.error("Error deleting document: ",e),alert("削除中にエラーが発生しました。")}finally{D(!1)}}};return N?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"データを読み込み中..."})]}):C||!u?(0,a.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[(0,a.jsx)("p",{children:C||"データが見つかりません"}),!x&&(0,a.jsx)("button",{className:"mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>J.push("/"),children:"マップに戻る"})]}):(0,a.jsxs)("div",{className:x?"w-full":"container mx-auto p-4 max-w-4xl",children:[!x&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 bg-blue-500 dark:bg-gray-700 text-black dark:text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[u.photoURL?(0,a.jsx)("div",{className:"w-12 h-12 rounded-full overflow-hidden mr-3",children:(0,a.jsx)(k.default,{src:u.photoURL,alt:u.nickname,width:48,height:48,className:"object-cover w-full h-full"})}):(0,a.jsx)(m.Z,{className:"w-12 h-12 mr-3 text-white"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:u.nickname})]}),(0,a.jsx)("button",{className:"bg-white dark:bg-gray-600 text-blue-500 dark:text-white px-3 py-1 rounded hover:bg-blue-100 dark:hover:bg-gray-500",onClick:()=>J.push("/"),children:"マップに戻る"})]})}),(0,a.jsx)("div",{className:"border-b dark:border-gray-700",children:(0,a.jsxs)("nav",{className:"flex",children:[(0,a.jsx)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("details"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("details"),children:"基本情報"}),(0,a.jsxs)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("conversations"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("conversations"),children:["会話履歴 (",v.length,")"]}),(0,a.jsx)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("recorder"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("recorder"),children:"会話を記録"}),(0,a.jsx)("button",{className:"px-4 py-2 ".concat("edit"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("edit"),children:"編集"})]})})]}),x&&(0,a.jsxs)("div",{className:"border-b dark:border-gray-700 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[u.photoURL?(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden mr-3",children:(0,a.jsx)(k.default,{src:u.photoURL,alt:u.nickname,width:40,height:40,className:"object-cover w-full h-full"})}):(0,a.jsx)(m.Z,{className:"w-10 h-10 mr-3 text-gray-400"}),(0,a.jsx)("h1",{className:"text-2xl font-bold dark:text-white",children:u.nickname})]}),(0,a.jsxs)("nav",{className:"flex mb-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("details"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("details"),children:"基本情報"}),(0,a.jsxs)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("conversations"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("conversations"),children:["会話履歴 (",v.length,")"]}),(0,a.jsx)("button",{className:"px-4 py-2 border-r dark:border-gray-700 ".concat("recorder"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("recorder"),children:"会話を記録"}),(0,a.jsx)("button",{className:"px-4 py-2 ".concat("edit"===P?"bg-blue-100 dark:bg-blue-900 font-bold text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"),onClick:()=>I("edit"),children:"編集"})]})]}),(0,a.jsxs)("div",{className:x?"":"p-4",children:["details"===P&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("dl",{children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"ニックネーム"}),(0,a.jsxs)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2 flex items-center",children:[u.photoURL?(0,a.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-2",children:(0,a.jsx)(k.default,{src:u.photoURL,alt:u.nickname,width:32,height:32,className:"object-cover w-full h-full"})}):(0,a.jsx)(m.Z,{className:"w-8 h-8 mr-2 text-gray-400"}),u.nickname]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"年齢層"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:u.ageGroup||"不明"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"カテゴリ"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:{regular:"定期的に会う（赤）",occasional:"たまに会う（黄）",new:"新規（緑）"}[t=u.category]||t})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"最終確認日"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:u.lastSeen})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"位置情報"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:u.locations&&u.locations.length>0?(0,a.jsx)("div",{className:"space-y-2",children:u.locations.map((e,t)=>(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 pl-3 py-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.description||"位置 ".concat(t+1)}),(0,a.jsxs)("button",{onClick:()=>G(e.latitude,e.longitude),className:"mt-1 flex items-center text-blue-500 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[(0,a.jsx)(b.Z,{size:16,className:"mr-1"}),"マップで表示"]}),e.timestamp&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["記録日: ",W(e.timestamp.toString())]})]},t))}):(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"位置情報がありません"})})]}),u.features&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"特徴"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:u.features})]}),u.photoURL&&(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4",children:[(0,a.jsx)("dt",{className:"font-medium text-gray-500 dark:text-gray-400",children:"プロフィール画像"}),(0,a.jsx)("dd",{className:"mt-1 text-gray-900 dark:text-white sm:mt-0 sm:col-span-2",children:(0,a.jsx)("div",{className:"w-40 h-40 rounded-lg overflow-hidden",children:(0,a.jsx)(k.default,{src:u.photoURL,alt:u.nickname,width:160,height:160,className:"object-cover w-full h-full"})})})]})]})}),"conversations"===P&&(0,a.jsx)("div",{children:0===v.length?(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"会話履歴がありません"}):(0,a.jsx)("ul",{className:"space-y-4",children:v.map(e=>(0,a.jsxs)("li",{className:"border rounded-lg overflow-hidden dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-2 font-medium flex justify-between items-center",children:[(0,a.jsx)("span",{className:"dark:text-white",children:e.date}),(0,a.jsxs)("button",{onClick:()=>F(e),className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center text-sm",children:[(0,a.jsx)(y.Z,{size:16,className:"mr-1"}),"編集"]})]}),(0,a.jsxs)("div",{className:"p-4 dark:bg-gray-900",children:[(0,a.jsx)("h3",{className:"font-bold mb-2 dark:text-white",children:"要約:"}),(0,a.jsx)("div",{className:"whitespace-pre-line mb-4 dark:text-gray-300",children:e.summary}),(0,a.jsxs)("details",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded",children:[(0,a.jsx)("summary",{className:"cursor-pointer dark:text-white",children:"文字起こしを表示"}),(0,a.jsx)("div",{className:"p-2 mt-2 dark:text-gray-300",children:e.transcript})]})]})]},e.id))})}),"recorder"===P&&(0,a.jsx)(h,{personId:r}),"edit"===P&&R&&(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded shadow-sm",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"情報を編集"}),(0,a.jsxs)("form",{onSubmit:T,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-900 dark:text-white text-sm font-bold mb-2",htmlFor:"nickname",children:"ニックネーム"}),(0,a.jsx)("input",{id:"nickname",type:"text",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-900 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:R.nickname,onChange:e=>U({...R,nickname:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-900 dark:text-white text-sm font-bold mb-2",htmlFor:"ageGroup",children:"年齢層"}),(0,a.jsxs)("select",{id:"ageGroup",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-900 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:R.ageGroup||"",onChange:e=>U({...R,ageGroup:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"不明"}),(0,a.jsx)("option",{value:"10代",children:"10代"}),(0,a.jsx)("option",{value:"20代",children:"20代"}),(0,a.jsx)("option",{value:"30代",children:"30代"}),(0,a.jsx)("option",{value:"40代",children:"40代"}),(0,a.jsx)("option",{value:"50代",children:"50代"}),(0,a.jsx)("option",{value:"60代",children:"60代"}),(0,a.jsx)("option",{value:"70代以上",children:"70代以上"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-900 dark:text-white text-sm font-bold mb-2",htmlFor:"category",children:"カテゴリ"}),(0,a.jsxs)("select",{id:"category",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-900 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:R.category,onChange:e=>U({...R,category:e.target.value}),children:[(0,a.jsx)("option",{value:"new",children:"新規（緑）"}),(0,a.jsx)("option",{value:"occasional",children:"たまに会う（黄）"}),(0,a.jsx)("option",{value:"regular",children:"定期的に会う（赤）"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-900 dark:text-white text-sm font-bold mb-2",htmlFor:"features",children:"特徴"}),(0,a.jsx)("textarea",{id:"features",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-900 dark:text-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline",value:R.features||"",onChange:e=>U({...R,features:e.target.value}),rows:3})]}),u.photoURL&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-900 dark:text-white text-sm font-bold mb-2",children:"現在のプロフィール画像"}),(0,a.jsx)("div",{className:"w-32 h-32 rounded-lg overflow-hidden",children:(0,a.jsx)(k.default,{src:u.photoURL,alt:u.nickname,width:128,height:128,className:"object-cover w-full h-full"})}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"画像を変更するには、新しく登録し直す必要があります。"})]}),L&&(0,a.jsx)("div",{className:"mb-4 p-2 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 rounded",children:"保存しました"}),(0,a.jsxs)("div",{className:"flex justify-end",children:[(0,a.jsx)("button",{type:"button",className:"mr-2 bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-black dark:text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>I("details"),children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-800 text-black dark:text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",disabled:Z,children:Z?"保存中...":"保存"})]})]})]})]}),z&&(0,a.jsx)(g,{conversation:z,onClose:()=>F(null),onSuccess:()=>{F(null)}}),(0,a.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,a.jsxs)("button",{onClick:O,disabled:Z,className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),Z?"削除中...":"削除"]}),(0,a.jsxs)("button",{onClick:()=>{J.push("/person/".concat(r))},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded flex items-center",children:["詳細 ",(0,a.jsx)(f.Z,{className:"w-4 h-4 ml-1"})]})]})]})}},8490:function(e,t,r){r.d(t,{AuthProvider:function(){return d},V:function(){return o}});var a=r(7437),s=r(2265),l=r(5735),n=r(2574);let o=(0,s.createContext)({user:null,loading:!0,signInWithGoogle:async()=>{},signOut:async()=>{}});function d(e){let{children:t}=e,[r,d]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=n.I8.onAuthStateChanged(e=>{d(e),c(!1)});return()=>e()},[]);let x=async()=>{let e=new l.hJ;try{await (0,l.rh)(n.I8,e)}catch(e){console.error("Error signing in with Google",e)}},h=async()=>{try{await (0,l.w7)(n.I8)}catch(e){console.error("Error signing out",e)}};return(0,a.jsx)(o.Provider,{value:{user:r,loading:i,signInWithGoogle:x,signOut:h},children:t})}},7807:function(e,t,r){r.d(t,{F:function(){return o},ThemeProvider:function(){return n}});var a=r(7437),s=r(2265);let l=(0,s.createContext)(void 0),n=e=>{let{children:t}=e,[r,n]=(0,s.useState)("light");return(0,s.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e?n(e):t&&n("dark")},[]),(0,s.useEffect)(()=>{"dark"===r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",r)},[r]),(0,a.jsx)(l.Provider,{value:{theme:r,toggleTheme:()=>{n(e=>"light"===e?"dark":"light")}},children:t})},o=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},2574:function(e,t,r){r.d(t,{I8:function(){return d},db:function(){return i},tO:function(){return c}});var a=r(5236),s=r(5735),l=r(9842),n=r(9854);let o=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyB5y7Hl1TkxMnT6m1YCwFXONgvy6yUKhbo",authDomain:"oikos-4bf07.firebaseapp.com",projectId:"oikos-4bf07",storageBucket:"oikos-4bf07.firebasestorage.app",messagingSenderId:"1081771625262",appId:"1:1081771625262:web:863be88a259d66a88688bf"}),d=(0,s.v0)(o),i=(0,l.ad)(o),c=(0,n.cF)(o)},666:function(e,t,r){r.d(t,{a:function(){return l}});var a=r(2265),s=r(8490);let l=()=>(0,a.useContext)(s.V)}}]);